<?xml version="1.0" encoding="ISO-8859-1"?>

<project name="SecOC" default="all" basedir=".">

  <!-- include ant-contrib -->
  <taskdef resource="net/sf/antcontrib/antlib.xml">
    <classpath>
      <fileset dir="../../dreisoft.tresos.generator.ng.api" />
    </classpath>
  </taskdef>

  <!-- set properties -->
  <ng.getgeneratorvar name="tresosBase" property="genTresosBase" />
  <ng.getgeneratorvar name="module"     property="genModule"     />
  <ng.getgeneratorvar name="pluginPath" property="genPluginDir"  />
  <ng.getgeneratorvar name="outputDir"  property="genOutputDir"  />
  <ng.getgeneratorvar name="datetime"   property="genDateTime"   />
  <ng.getgeneratorvar name="project"    property="genProject"    />

  <!-- WORKAROUND [TRESOSWP-3967] -->
  <ng.property name="org.rte.enabled.all" xpath="as:modconf('SecOC')/SecOCEbGeneral/SecOCRteUsage = 'true'" />

  <property environment="env"                                                     />
  <property name="genPluginDirGenerateSwcd" value="${genPluginDir}/generate_swcd" />

  <!-- process -->
  <target name="all" depends="Process.Generate_Swcd" />

  <target name="Process.Generate_Swcd">
    <sequential>
      <for list="swcd" param="dir">
        <sequential>
          <for param="file">
            <path>
              <fileset dir="${genPluginDirGenerateSwcd}/@{dir}/" excludes="*.m" />
            </path>
            <sequential>
              <basename property="org.file.basename" file="@{file}" />
              <echo level="info" message="FILE: @{file} // @{dir}/${org.file.basename} ... ${org.rte.enabled.all}" />
              <!-- WORKAROUND [TRESOSWP-3967] -->
              <if>
                <or>
                  <equals arg1="${org.file.basename}"   arg2="SecOC_Bswmd.arxml" />
                  <equals arg1="${org.rte.enabled.all}" arg2="true"              />
                </or>
                <then>
                  <ng.tmplgen template="@{file}" file="@{dir}/${org.file.basename}" failonerror="true">
                    <include path="generate_swcd" />
                    <variable name="project" value="${genProject}" />
                  </ng.tmplgen>
                </then>
              </if>
              <var name="org.file.basename" unset="true" />
            </sequential>
          </for>
        </sequential>
      </for>
    </sequential>
  </target>

</project>
